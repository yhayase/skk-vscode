# 接頭辞変換機能の実装タスクリスト

## 概要
このタスクリストは、SKK入力システムにおける接頭辞変換機能の実装のための具体的な仕様と作業項目を定義します。接頭辞変換機能は、見出し語モード（MidashigoMode）で「>」が入力された際に、「>」つきの見出し語（例：「だい>」）を検索し、候補を表示する機能です。

## タスクリスト

### 1. テストの作成（Red フェーズ）
- [ ] ユニットテストファイル `{PROJECT_ROOT}/test/unit/midashigo-mode-prefix.test.ts` を作成し、接頭辞変換機能のための「失敗する小さなテスト」を記述する。
  - テストケース：MidashigoMode で「Dai>」と入力した場合に「だい>」として検索され、候補が表示されることを検証。
  - テストケース：`getActiveKeys` メソッドが「>」をアクティブキーとして返すことを検証。
  - テストケース：既存のモード遷移や他の入力処理に影響を与えないことを検証。

### 2. キーバインドの追加（Green フェーズ）
- [ ] `package.json` の `contributes.keybindings` セクションに「>」キーのキーバインドを追加する。
  - キーバインド設定：`skk.symbolInput` コマンドに「>」をバインド（`shift+.`）。
  - 条件：`editorTextFocus && skk.activeKey.greater`。

### 3. MidashigoMode の更新（Green フェーズ）
- [ ] `src/lib/skk/input-mode/henkan/MidashigoMode.ts` を更新し、接頭辞変換機能を実装する。
  - `getActiveKeys` メソッドを更新し、「>」キーをアクティブキーとして追加。
  - `onSymbol` メソッドを拡張し、「>」入力時の特別な処理を追加（接頭辞として扱い、検索キー生成）。
  - `createJisyoKey` メソッドを修正し、「>」を含む見出し語を適切に処理。
  - `findCandidates` メソッドを拡張し、「>」つきの見出し語検索をサポート。

### 4. 辞書処理の調整（Green フェーズ）
- [ ] `src/lib/jisyo/entry.ts` または関連ファイルを更新し、接頭辞検索ロジックを追加。
  - 辞書エントリー検索ロジックを拡張し、「>」を含むキーを処理。
  - 接頭辞候補の表示形式や優先順位を調整（必要に応じてユーザー確認）。

### 5. リファクタリング（Refactor フェーズ）
- [ ] 追加したコードをリファクタリングし、関数型アプローチ（純粋関数、不変データ構造）を優先。
  - 可読性と設計の改善。
  - 既存のコードとの整合性を保つ。

### 6. テストの実行と検証
- [x] 変更の前後に `npm run test:unit` でユニットテストを実行。
- [ ] 必要に応じて `npm run test:integration` でインテグレーションテストを実行。
- [ ] 2回以上連続でテストが失敗した場合、状況を整理し、ユーザーと解決方法を検討。
>>>>>>> REPLACE

### 7. Git ブランチ戦略とコミット
- [ ] 作業ブランチ `feature/prefix-conversion` を作成し、作業を行う。
- [ ] 小さくて意味のある単位でコミットし、すべてのコミット前にテストが合格していることを確認。
- [ ] テスト合格後に main ブランチにマージ。

## 次のステップ
- タスクリストの項目を順に実行し、Red-Green-Refactor サイクルを回す。
- 不明点や問題が発生した場合、ユーザーに確認する。

## 備考
- 接頭辞候補の表示形式や優先順位に関する詳細な仕様が不明な場合、実装前にユーザーに確認する。
- 既存のモード遷移や入力処理に影響を与えないよう、慎重に実装とテストを行う。
