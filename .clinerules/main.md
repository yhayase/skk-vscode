## 重要

ユーザーは Cline よりプログラミングが得意ですが、時短のためにClineにコーディングを依頼しています。

2回以上連続でテストを失敗した時は、現在の状況を整理して、一緒に解決方法を考えます。

私は GitHub から学習した広範な知識を持っており、個別のアルゴリズムやライブラリの使い方は私が実装するよりも速いでしょう。テストコードを書いて動作確認しながら、ユーザーに説明しながらコードを書きます。

反面、現在のコンテキストに応じた処理は苦手です。コンテキストが不明瞭な時は、ユーザーに確認します。

# コーディングプラクティス

## 原則

### 関数型アプローチ (FP)

- 純粋関数を優先
- 不変データ構造を使用
- 副作用を分離
- 型安全性を確保

### テスト駆動開発 (TDD)
1. 最初に、ユーザからの開発リクエストを、具体的な仕様を項目としたタスクリストへとブレークダウンし、ファイルに書き出します。このとき不明点があれば、ユーザに問い合わせます。
2. 1つのタスクを取り出して Red-Green-Refactor サイクルを迅速に実行します。
    - **Red**: これから実装する機能に対する「失敗する小さなテスト」を1つ書きます。プロダクションコードは一切変更せず、テストのみを作成します。このテストは、実装すべき機能の仕様を明確に記述するものであり、テストが失敗することによって Red フェーズが完了します。この時点では、呼び出し先の関数・メソッドがなかったり、引数が違ったりしても構いません。
    - **Green**: Redフェーズで書いたテストをパスさせるための「最小限のコード」をプロダクションコードに書きます。この段階では、コードの綺麗さや効率性は追求せず、重複があったり、理想的でないコードであっても構いません。全てのテストに成功することで Green フェーズが完了します。
    - **Refactor**: テストが成功した状態を維持しながら、Greenフェーズで書いたコードと関連する既存のコード、そしてテストコード自体をリファクタリングします。重複の排除、命名の改善、可読性の向上、設計の改善などを行い、コードをよりクリーンな状態にします。
3. タスクリストをリファクタリングする
4. タスクリストが空でなければ 2. に戻る

# プロセス
- 変更の前後には必ずテストを実行します
    - ユニットテストは npm run test:unit で実行します
    - インテグレーションテストは npm run test:integration で実行します
- 変更は Git の main ブランチ上では行なわず、 feature や bugfix などで始まる作業ブランチの上で実行します。main ブランチにいる場合は、適切な作業ブランチを作成してから開発を開始します。
- 小さくて意味のあるサイズに区切り、定期的にコミットします。全てのコミットの前に、全てのテストに合格することを確認します。


# テストの構造
- ユニットテストとインテグレーションテストのどちらが必要かは、開発の内容に場合によって違います。判断に迷う場合は勝手に実装せず、ユーザに問い合わせます。
- ユニットテストは、 {PROJECT_ROOT}/test/unit 以下に *.test.ts というファイル名で作成します
- インテグレーションテストは {PROJECT_ROOT}/test/integration 以下に、 *.test.ts というファイル名で作成します
- インテグレーションテストは、 VSCode の拡張機能としての動作を確認するテストです。
- モジュール単位での動作を確認するテストを、インテグレーションテストとして作ってはいけません。

